!function(t){function e(r){if(i[r])return i[r].exports;var o=i[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");i(4),i(5),i(2),i(3),i(6),i(7)},function(t,e){t.exports.LOCALSTORAGE_RECORDINGS="avatarRecordings",t.exports.DEFAULT_RECORDING_NAME="default"},function(t,e,i){var r=i(1),o=AFRAME.utils.debug("aframe-motion-capture:avatar-recorder:info"),a=AFRAME.utils.debug("aframe-motion-capture:avatar-recorder:warn");AFRAME.registerComponent("avatar-recorder",{schema:{autoRecord:{default:!1},autoPlay:{default:!0},autoSaveFile:{default:!0},spectatorPlay:{default:!1},spectatorPosition:{default:"0 1.6 0",type:"vec3"},localStorage:{default:!0},recordingName:{default:r.DEFAULT_RECORDING_NAME},loop:{default:!0}},init:function(){this.trackedControllerEls={},this.onKeyDown=this.onKeyDown.bind(this),this.tick=AFRAME.utils.throttle(this.throttledTick,100,this)},replayRecording:function(){var t,e,i=this.data,a=this.el;e=JSON.parse(localStorage.getItem(r.LOCALSTORAGE_RECORDINGS)),t=e&&e[i.recordingName]?e[i.recordingName]:this.recordingData,t&&(o("Replaying recording."),a.setAttribute("avatar-replayer",{loop:i.loop,spectatorMode:i.spectatorPlay,spectatorPosition:i.spectatorPosition}),a.components["avatar-replayer"].startReplaying(t))},stopReplaying:function(){var t=this.el.components["avatar-replayer"];t&&t.isReplaying&&(o("Stopped replaying."),t.stopReplaying(),this.el.setAttribute("avatar-replayer","spectatorMode",!1))},throttledTick:function(){var t=this,e=this.el.querySelectorAll("[tracked-controls]");this.trackedControllerEls={},e.forEach(function(e){return e.id?(e.setAttribute("motion-capture-recorder",{autoRecord:!1,visibleStroke:!1}),t.trackedControllerEls[e.id]=e,void(t.isRecording&&e.components["motion-capture-recorder"].startRecording())):void a("Found tracked controllers with no id. It will not be recorded")})},play:function(){var t=this;this.data.autoPlay&&setTimeout(function(){t.replayRecording()},500),window.addEventListener("keydown",this.onKeyDown)},pause:function(){window.removeEventListener("keydown",this.onKeyDown)},onKeyDown:function(t){var e=t.keyCode,i={space:32,c:67,p:80,u:85};switch(e){case i.space:this.toggleRecording();break;case i.p:this.toggleReplaying();break;case i.c:this.clearRecordings();break;case i.u:this.uploadRecording()}},clearRecordings:function(){o("Recordings cleared from localStorage."),this.recordingData=null,localStorage.removeItem(r.LOCALSTORAGE_RECORDINGS)},toggleReplaying:function(){var t=this.el.components["avatar-replayer"];t||(this.el.setAttribute("avatar-replayer",""),t=this.el.components["avatar-replayer"]),t.isReplaying?this.stopReplaying():this.replayRecording()},toggleRecording:function(){this.isRecording?this.stopRecording():this.startRecording()},setupCamera:function(t){function e(t){i(t.detail.cameraEl)}function i(i){o.cameraEl&&o.cameraEl.removeAttribute("motion-capture-recorder"),o.cameraEl=i,i.setAttribute("motion-capture-recorder",{autoRecord:!1,visibleStroke:!1}),r.removeEventListener("camera-set-active",e),t(i)}var r=this.el,o=this;return r.camera&&r.camera.el?void i(r.camera.el):void r.addEventListener("camera-set-active",e)},startRecording:function(){var t,e=this.trackedControllerEls,i=this;this.isRecording||(t=Object.keys(e),o("Starting recording!"),this.stopReplaying(),this.setupCamera(function(){i.isRecording=!0,i.cameraEl.components["motion-capture-recorder"].startRecording(),t.forEach(function(t){e[t].components["motion-capture-recorder"].startRecording()})}))},stopRecording:function(){var t=this.trackedControllerEls,e=Object.keys(t);this.isRecording&&(o("Stopped recording."),this.isRecording=!1,this.cameraEl.components["motion-capture-recorder"].stopRecording(),e.forEach(function(e){t[e].components["motion-capture-recorder"].stopRecording()}),this.saveRecording(),this.data.autoPlay&&this.replayRecording())},getJSONData:function(){var t={},e=this.trackedControllerEls,i=Object.keys(e);if(!this.isRecording)return this.isRecording=!1,t.camera=this.cameraEl.components["motion-capture-recorder"].getJSONData(),i.forEach(function(i){t[i]=e[i].components["motion-capture-recorder"].getJSONData()}),this.recordingData=t,t},saveRecording:function(){var t=this.getJSONData();this.data.localStorage&&(o("Recording saved to localStorage."),this.saveToLocalStorage(t)),this.data.autoSaveFile&&(o("Recording saved to file."),this.saveRecordingFile(t))},saveToLocalStorage:function(t){var e,i=this.data;e=JSON.parse(localStorage.getItem(r.LOCALSTORAGE_RECORDINGS))||{},e[i.recordingName]=t,localStorage.setItem(r.LOCALSTORAGE_RECORDINGS,JSON.stringify(e))},saveRecordingFile:function(t){var e,i,o,a,s;a="object"==typeof t?JSON.stringify(t):localStorage.getItem(r.LOCALSTORAGE_RECORDINGS)[t],i=new Blob([a],{type:this.data.binaryFormat?"application/octet-binary":"application/json"}),s=URL.createObjectURL(i),o="recording-"+document.title.toLowerCase().replace(/ /g,"-")+".json",e=document.createElement("a"),e.href=s,e.setAttribute("download",o),e.innerHTML="Downloading...",e.style.display="none",document.body.appendChild(e),setTimeout(function(){e.click(),document.body.removeChild(e)})},uploadRecording:function(){var t;return this.recordingData?(o("Uploading recording to myjson.com."),t=new XMLHttpRequest,t.open("POST",window.location.protocol+"//api.myjson.com/bins",!0),t.setRequestHeader("Content-type","application/json; charset=utf-8"),t.onload=function(){var t,e=JSON.parse(this.responseText).uri;o("Recording uploaded to",e),t=document.createElement("a"),t.innerHTML=e,t.setAttribute("href",e),t.style.position="fixed",t.style.display="block",t.style.zIndex=99999,t.style.background="#111",t.style.color="#FAFAFA",t.style.padding="15px",t.style.left=0,t.style.top=0,document.body.appendChild(t)},void t.send(JSON.stringify(this.recordingData))):void o("Cannot upload without a recording in memory.")}})},function(t,e,i){var r=i(1),o=AFRAME.utils.debug("aframe-motion-capture:avatar-replayer:error"),a=AFRAME.utils.debug("aframe-motion-capture:avatar-replayer:info"),s=AFRAME.utils.debug("aframe-motion-capture:avatar-replayer:warn");AFRAME.registerComponent("avatar-replayer",{schema:{autoPlay:{default:!0},cameraOverride:{type:"selector"},loop:{default:!1},recordingName:{default:r.DEFAULT_RECORDING_NAME},spectatorMode:{default:!1},spectatorPosition:{default:{x:0,y:1.6,z:2},type:"vec3"},src:{default:""}},init:function(){var t=this.el;this.setupCameras=this.setupCameras.bind(this),t.camera?this.setupCameras():this.el.addEventListener("camera-set-active",this.setupCameras),this.el.addEventListener("replayingstopped",this.restoreCamera.bind(this)),this.onKeyDown=this.onKeyDown.bind(this)},update:function(t){var e=this.data;"spectatorMode"in t&&t.spectatorMode!==e.spectatorMode&&(e.spectatorMode?this.activateSpectatorCamera():this.deactivateSpectatorCamera()),t.src!==e.src&&e.autoPlay&&(this.replayRecordingFromSource(t),this.activateSpectatorCamera())},play:function(){window.addEventListener("keydown",this.onKeyDown)},pause:function(){window.removeEventListener("keydown",this.onKeyDown)},remove:function(){this.stopReplaying(),this.cameraEl.removeObject3D("replayerMesh")},restoreCamera:function(){this.data.spectatorMode&&this.cameraEl.setAttribute("camera","active",!0)},setupCameras:function(){var t=this.data,e=this.el;t.cameraOverride?this.cameraEl=t.cameraOverride:(this.cameraEl=e.camera.el,this.cameraEl.removeAttribute("data-aframe-default-camera")),this.el.removeEventListener("camera-set-active",this.setupCameras),this.initSpectatorCamera(),this.configureHeadGeometry()},onKeyDown:function(t){var e=t.keyCode;switch(e){case 81:this.el.setAttribute("avatar-replayer","spectatorMode",!this.data.spectatorMode)}},activateSpectatorCamera:function(){var t=this.spectatorCameraEl;return t?t.hasLoaded?(a("Activating spectator camera"),t.setAttribute("camera","active",!0),void(this.cameraEl.getObject3D("replayerMesh").visible=!0)):void t.addEventListener("loaded",this.activateSpectatorCamera.bind(this)):void this.el.sceneEl.addEventListener("camera-set-active",this.activateSpectatorCamera.bind(this))},deactivateSpectatorCamera:function(){a("Deactivating spectator camera"),this.cameraEl.setAttribute("camera","active",!0),this.cameraEl.getObject3D("replayerMesh").visible=!1},initSpectatorCamera:function(){var t,e,i=this.data,r=this.el;return this.el.querySelector("#spectatorCameraRig")?void(this.spectatorCameraEl=this.el.querySelector("#spectatorCameraRig")):(t=this.spectatorCameraEl=r.querySelector("#spectatorCamera")||document.createElement("a-entity"),e=this.spectatorCameraRigEl=r.querySelector("#spectatorCameraRig")||document.createElement("a-entity"),e.setAttribute("position",i.spectatorPosition),t.id="spectatorCamera",e.id="spectatorCameraRig",t.setAttribute("camera",{active:i.spectatorMode,userHeight:0}),t.setAttribute("look-controls",""),t.setAttribute("wasd-controls",{fly:!0}),e.appendChild(t),void r.appendChild(e))},replayRecordingFromSource:function(t){var e,i,o,s=this.data;if(null===new URLSearchParams(window.location.search).get("avatar-replayer-disabled"))return i=this.getSrcFromSearchParam(),e=JSON.parse(localStorage.getItem(r.LOCALSTORAGE_RECORDINGS))||{},e[i]?(a("Replaying `"+i+"` from localStorage."),void this.startReplaying(e[i])):(o=i||s.src)?(s.src?a("Replaying from component `src`",o):i&&a("Replaying from query parameter `avatar-recording`",o),void this.loadRecordingFromUrl(o,!1,this.startReplaying.bind(this))):void(e[s.recordingName]&&(a("Replaying `"+s.recordingName+"` from localStorage."),this.startReplaying(e[s.recordingName])))},getSrcFromSearchParam:function(){return new URLSearchParams(window.location.search).get("avatar-recording")},startReplaying:function(t){var e=this.data,i=this,r=this.el;if(!this.isReplaying){if(!this.el.camera)return void this.el.addEventListener("camera-set-active",function(){i.startReplaying(t)});this.replayData=t,this.isReplaying=!0,this.cameraEl.removeAttribute("motion-capture-replayer"),Object.keys(t).forEach(function(s){var n;if("camera"===s)a("Setting motion-capture-replayer on camera."),n=i.cameraEl;else if(a("Setting motion-capture-replayer on "+s+"."),n=r.querySelector("#"+s),!n)return void o("No element found with ID "+s+".");a("Setting motion-capture-replayer on "+s+"."),n.setAttribute("motion-capture-replayer",{loop:e.loop}),n.components["motion-capture-replayer"].startReplaying(t[s])})}},configureHeadGeometry:function(){var t,e,i,r,o,a=this.cameraEl;a.getObject3D("mesh")||(t=new THREE.Mesh,t.geometry=new THREE.BoxBufferGeometry(.3,.3,.2),t.material=new THREE.MeshStandardMaterial({color:"pink"}),t.visible=this.data.spectatorMode,e=new THREE.Mesh,e.geometry=new THREE.SphereBufferGeometry(.05),e.material=new THREE.MeshBasicMaterial({color:"white"}),e.position.x-=.1,e.position.y+=.1,e.position.z-=.1,r=new THREE.Mesh,r.geometry=new THREE.SphereBufferGeometry(.025),r.material=new THREE.MeshBasicMaterial({color:"black"}),r.position.z-=.04,e.add(r),t.add(e),i=new THREE.Mesh,i.geometry=new THREE.SphereBufferGeometry(.05),i.material=new THREE.MeshBasicMaterial({color:"white"}),i.position.x+=.1,i.position.y+=.1,i.position.z-=.1,o=new THREE.Mesh,o.geometry=new THREE.SphereBufferGeometry(.025),o.material=new THREE.MeshBasicMaterial({color:"black"}),o.position.z-=.04,i.add(o),t.add(i),a.setObject3D("replayerMesh",t))},stopReplaying:function(){var t=this;this.isReplaying&&this.replayData&&(this.isReplaying=!1,Object.keys(this.replayData).forEach(function(e){if("camera"===e)t.cameraEl.removeComponent("motion-capture-replayer");else{if(el=document.querySelector("#"+e),!el)return void s("No element with id "+e);el.removeComponent("motion-capture-replayer")}}))},loadRecordingFromUrl:function(t,e,i){var r,o=new THREE.FileLoader(this.manager),a=this;o.crossOrigin="anonymous",e===!0&&o.setResponseType("arraybuffer"),o.load(t,function(t){r=e===!0?a.loadStrokeBinary(t):JSON.parse(t),i&&i(r)})}})},function(t,e){var i={axismove:{id:0,props:["id","axis"]},buttonchanged:{id:1,props:["id","state"]},buttondown:{id:2,props:["id","state"]},buttonup:{id:3,props:["id","state"]},touchstart:{id:4,props:["id","state"]},touchend:{id:5,props:["id","state"]}};AFRAME.registerComponent("motion-capture-recorder",{schema:{autoRecord:{default:!1},enabled:{default:!0},hand:{default:"right"},recordingControls:{default:!1},persistStroke:{default:!1},visibleStroke:{default:!0}},init:function(){this.drawing=!1,this.recordedEvents=[],this.recordedPoses=[],this.addEventListeners()},addEventListeners:function(){var t=this.el;this.recordEvent=this.recordEvent.bind(this),t.addEventListener("axismove",this.recordEvent),t.addEventListener("buttonchanged",this.onTriggerChanged.bind(this)),t.addEventListener("buttonchanged",this.recordEvent),t.addEventListener("buttonup",this.recordEvent),t.addEventListener("buttondown",this.recordEvent),t.addEventListener("touchstart",this.recordEvent),t.addEventListener("touchend",this.recordEvent)},recordEvent:function(t){var e;this.isRecording&&("detail"in t&&"state"in t.detail&&"object"==typeof t.detail.state&&"target"in t.detail.state&&delete t.detail.state.target,e={},i[t.type].props.forEach(function(i){if("state"!==i)e[i]=t.detail[i];else{var r;e.state={};for(r in t.detail.state)e.state[r]=t.detail.state[r]}}),this.recordedEvents.push({name:t.type,detail:e,timestamp:this.lastTimestamp}))},onTriggerChanged:function(t){var e,i=this.data;if(i.enabled&&!i.autoRecord&&1===t.detail.id&&this.data.recordingControls)return e=t.detail.state.value,e<=.1?void(this.isRecording&&this.stopRecording()):void(this.isRecording||this.startRecording())},getJSONData:function(){var t,e=this.el.components["tracked-controls"],i=e&&e.controller;if(this.recordedPoses)return t={poses:this.getStrokeJSON(this.recordedPoses),events:this.recordedEvents},i&&(t.gamepad={id:i.id,hand:i.hand,index:i.index}),t},getStrokeJSON:function(t){for(var e,i=[],r=0;r<t.length;r++)e=t[r],i.push({position:e.position,rotation:e.rotation,timestamp:e.timestamp});return i},saveCapture:function(t){var e=JSON.stringify(this.getJSONData()),i=t?"application/octet-binary":"application/json",r=new Blob([e],{type:i}),o=URL.createObjectURL(r),a="motion-capture-"+document.title+"-"+Date.now()+".json",s=document.createElement("a");s.setAttribute("class","motion-capture-download"),s.href=o,s.setAttribute("download",a),s.innerHTML="downloading...",s.style.display="none",document.body.appendChild(s),setTimeout(function(){s.click(),document.body.removeChild(s)},1)},update:function(){var t=this.el,e=this.data;if(this.data.autoRecord)this.startRecording();else{if(t.components.camera)return;e.recordingControls&&(t.setAttribute("vive-controls",{hand:e.hand}),t.setAttribute("oculus-touch-controls",{hand:e.hand})),t.setAttribute("stroke","")}},tick:function(){var t=new THREE.Vector3,e=new THREE.Quaternion,i=new THREE.Vector3;return function(r,o){var a,s;this.lastTimestamp=r,this.data.enabled&&this.isRecording&&(a={position:this.el.getAttribute("position"),rotation:this.el.getAttribute("rotation"),timestamp:r},this.recordedPoses.push(a),this.data.visibleStroke&&(this.el.object3D.updateMatrixWorld(),this.el.object3D.matrixWorld.decompose(t,e,i),s=this.getPointerPosition(t,e),this.el.components.stroke.drawPoint(t,e,r,s)))}}(),getPointerPosition:function(){var t=new THREE.Vector3,e=new THREE.Vector3(0,.7,1);return function(i,r){var o=e.clone().applyQuaternion(r).normalize().multiplyScalar(-.03);return t.copy(i).add(o),t}}(),startRecording:function(){var t=this.el;this.isRecording||(t.components.stroke&&t.components.stroke.reset(),this.isRecording=!0,this.recordedPoses=[],this.recordedEvents=[],t.emit("strokestarted",{entity:t,poses:this.recordedPoses}))},stopRecording:function(){var t=this.el;this.isRecording&&(t.emit("strokeended",{poses:this.recordedPoses}),this.isRecording=!1,this.data.visibleStroke&&!this.data.persistStroke&&t.components.stroke.reset())}})},function(t,e){function i(t,e){t.setAttribute("position",e.position),t.setAttribute("rotation",e.rotation)}AFRAME.registerComponent("motion-capture-replayer",{schema:{enabled:{default:!0},recorderEl:{type:"selector"},loop:{default:!1},src:{default:""},spectatorCamera:{default:!1}},init:function(){this.currentPoseTime=0,this.currentEventTime=0,this.currentPoseIndex=0,this.currentEventIndex=0,this.onStrokeStarted=this.onStrokeStarted.bind(this),this.onStrokeEnded=this.onStrokeEnded.bind(this),this.playComponent=this.playComponent.bind(this),this.el.addEventListener("pause",this.playComponent),this.discardedFrames=0,this.playingEvents=[],this.playingPoses=[]},remove:function(){this.el.removeEventListener("pause",this.playComponent),this.stopReplaying(),this.el.pause(),this.el.play()},update:function(t){var e=this.data;this.updateRecorder(e.recorderEl,t.recorderEl),this.el.isPlaying||this.playComponent(),t.src!==e.src&&e.src&&this.updateSrc(e.src)},updateRecorder:function(t,e){e&&e!==t&&(e.removeEventListener("strokestarted",this.onStrokeStarted),e.removeEventListener("strokeended",this.onStrokeEnded)),t&&e!==t&&(t.addEventListener("strokestarted",this.onStrokeStarted),t.addEventListener("strokeended",this.onStrokeEnded))},updateSrc:function(t){this.el.sceneEl.systems["motion-capture-recorder"].loadRecordingFromUrl(t,!1,this.startReplaying.bind(this))},onStrokeStarted:function(t){this.reset()},onStrokeEnded:function(t){this.startReplayingPoses(t.detail.poses)},play:function(){this.playingStroke&&this.playStroke(this.playingStroke)},playComponent:function(){this.el.isPlaying=!0,this.play()},startReplaying:function(t){this.ignoredFrames=0,this.storeInitialPose(),this.isReplaying=!0,this.startReplayingPoses(t.poses),this.startReplayingEvents(t.events),t.gamepad&&(this.el.sceneEl.systems["motion-capture-replayer"].gamepads.push(t.gamepad),this.el.emit("gamepadconnected")),this.el.emit("replayingstarted")},stopReplaying:function(){this.isReplaying=!1,this.restoreInitialPose(),this.el.emit("replayingstopped")},storeInitialPose:function(){var t=this.el;this.initialPose={position:t.getAttribute("position"),rotation:t.getAttribute("rotation")}},restoreInitialPose:function(){var t=this.el;this.initialPose&&(t.setAttribute("position",this.initialPose.position),t.setAttribute("rotation",this.initialPose.rotation))},startReplayingPoses:function(t){this.isReplaying=!0,this.currentPoseIndex=0,0!==t.length&&(this.playingPoses=t,this.currentPoseTime=t[0].timestamp)},startReplayingEvents:function(t){var e;this.isReplaying=!0,this.currentEventIndex=0,0!==t.length&&(e=t[0],this.playingEvents=t,this.currentEventTime=e.timestamp,this.el.emit(e.name,e))},reset:function(){this.playingPoses=null,this.currentTime=void 0,this.currentPoseIndex=void 0},playRecording:function(t){var e,r,o=this.playingPoses,a=this.playingEvents;for(e=o&&o[this.currentPoseIndex],r=a&&a[this.currentEventIndex],this.currentPoseTime+=t,this.currentEventTime+=t;e&&this.currentPoseTime>=e.timestamp||r&&this.currentPoseTime>=r.timestamp;)e&&this.currentPoseTime>=e.timestamp&&(this.currentPoseIndex===o.length-1&&(this.data.loop?(this.currentPoseIndex=0,this.currentPoseTime=o[0].timestamp):this.stopReplaying()),i(this.el,e),this.currentPoseIndex+=1,e=o[this.currentPoseIndex]),r&&this.currentPoseTime>=r.timestamp&&(this.currentEventIndex===a.length&&this.data.loop&&(this.currentEventIndex=0,this.currentEventTime=a[0].timestamp),this.el.emit(r.name,r.detail),this.currentEventIndex+=1,r=this.playingEvents[this.currentEventIndex])},tick:function(t,e){return 2===this.ignoredFrames||window.debug?void(this.isReplaying&&this.playRecording(e)):void this.ignoredFrames++}})},function(t,e){AFRAME.registerComponent("stroke",{schema:{enabled:{default:!0},color:{default:"#ef2d5e",type:"color"}},init:function(){var t,e=this.maxPoints=3e3;this.idx=0,this.numPoints=0,this.vertices=new Float32Array(3*e*3),this.normals=new Float32Array(3*e*3),this.uvs=new Float32Array(2*e*2),this.geometry=new THREE.BufferGeometry,this.geometry.setDrawRange(0,0),this.geometry.addAttribute("position",new THREE.BufferAttribute(this.vertices,3).setDynamic(!0)),this.geometry.addAttribute("uv",new THREE.BufferAttribute(this.uvs,2).setDynamic(!0)),this.geometry.addAttribute("normal",new THREE.BufferAttribute(this.normals,3).setDynamic(!0)),this.material=new THREE.MeshStandardMaterial({color:this.data.color,roughness:.75,metalness:.25,side:THREE.DoubleSide});var i=new THREE.Mesh(this.geometry,this.material);i.drawMode=THREE.TriangleStripDrawMode,i.frustumCulled=!1,t=document.createElement("a-entity"),t.setObject3D("stroke",i),this.el.sceneEl.appendChild(t)},update:function(){this.material.color.set(this.data.color)},drawPoint:function(){var t=new THREE.Vector3,e=new THREE.Vector3,r=new THREE.Vector3;return function(o,a,s,n){var c=0,d=this.numPoints,l=.01;if(d!==this.maxPoints){for(i=0;i<d;i++)this.uvs[c++]=i/(d-1),this.uvs[c++]=0,this.uvs[c++]=i/(d-1),this.uvs[c++]=1;return t.set(1,0,0),t.applyQuaternion(a),t.normalize(),e.copy(n),r.copy(n),e.add(t.clone().multiplyScalar(l/2)),r.add(t.clone().multiplyScalar(-l/2)),this.vertices[this.idx++]=e.x,this.vertices[this.idx++]=e.y,this.vertices[this.idx++]=e.z,this.vertices[this.idx++]=r.x,this.vertices[this.idx++]=r.y,this.vertices[this.idx++]=r.z,this.computeVertexNormals(),this.geometry.attributes.normal.needsUpdate=!0,this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.uv.needsUpdate=!0,this.geometry.setDrawRange(0,2*d),this.numPoints+=1,!0}}}(),reset:function(){var t=0,e=this.vertices;for(i=0;i<this.numPoints;i++)e[t++]=0,e[t++]=0,e[t++]=0,e[t++]=0,e[t++]=0,e[t++]=0;this.geometry.setDrawRange(0,0),this.idx=0,this.numPoints=0},computeVertexNormals:function(){for(var t=new THREE.Vector3,e=new THREE.Vector3,i=new THREE.Vector3,r=new THREE.Vector3,o=new THREE.Vector3,a=0,s=this.idx;a<s;a++)this.normals[a]=0;var n=!0;for(a=0,s=this.idx;a<s;a+=3)n?(t.fromArray(this.vertices,a),e.fromArray(this.vertices,a+3),i.fromArray(this.vertices,a+6)):(t.fromArray(this.vertices,a+3),e.fromArray(this.vertices,a),i.fromArray(this.vertices,a+6)),n=!n,r.subVectors(i,e),o.subVectors(t,e),r.cross(o),r.normalize(),this.normals[a]+=r.x,this.normals[a+1]+=r.y,this.normals[a+2]+=r.z,this.normals[a+3]+=r.x,this.normals[a+4]+=r.y,this.normals[a+5]+=r.z,this.normals[a+6]+=r.x,this.normals[a+7]+=r.y,this.normals[a+8]+=r.z;for(a=6,s=this.idx-6;a<s;a++)this.normals[a]=this.normals[a]/3;this.normals[3]=this.normals[3]/2,this.normals[4]=this.normals[4]/2,this.normals[5]=this.normals[5]/2,this.normals[this.idx-6]=this.normals[this.idx-6]/2,this.normals[this.idx-6+1]=this.normals[this.idx-6+1]/2,this.normals[this.idx-6+2]=this.normals[this.idx-6+2]/2,this.geometry.normalizeNormals()}})},function(t,e){AFRAME.registerSystem("motion-capture-replayer",{init:function(){var t=this.sceneEl,e=t.systems["tracked-controls"],i=AFRAME.components["tracked-controls"].Component.prototype.tick;this.gamepads=[],this.updateControllerListOriginal=e.updateControllerList.bind(e),t.systems["tracked-controls"].updateControllerList=this.updateControllerList.bind(this),AFRAME.components["tracked-controls"].Component.prototype.tick=this.trackedControlsTickWrapper,AFRAME.components["tracked-controls"].Component.prototype.trackedControlsTick=i},trackedControlsTickWrapper:function(t,e){this.el.components["motion-capture-replayer"]||this.trackedControlsTick(t,e)},updateControllerList:function(){var t,e=this.sceneEl,i=e.systems["tracked-controls"];for(this.updateControllerListOriginal(),this.gamepads.forEach(function(t){i.controllers[t.index]||(i.controllers[t.index]=t)}),t=0;t<i.controllers.length;++t)i.controllers[t]||(i.controllers[t]={id:"___",index:-1,hand:"finger"})}})}]);